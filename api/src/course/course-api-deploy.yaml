AWSTemplateFormatVersion: '2010-09-09'
Description: Max Aldunate Pro API
Outputs:
  ApiGatewayApiName:
    Description: ApiGatewayApi name
    Value:
      Ref: ApiGatewayApi
  ApiGatewayId:
    Description: API Gateway endpoint URL for Production https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/hello/
    Value:
      Ref: ApiGatewayApi
  ApiGatewayUrl:
    Description: URL of your API endpoint
    Value:
      Fn::Join:
      - ''
      - - https://
        - Ref: ApiGatewayApi
        - .execute-api.
        - Ref: AWS::Region
        - .amazonaws.com/Prod
  FnCourseName:
    Description: FnCourse name
    Value:
      Ref: FnCourse
  TableCourseName:
    Description: TableCourse name
    Value:
      Ref: TableCourse
Parameters:
  SwaggerS3File:
    Default: course-fn.js
    Description: The uploaded swagger.yaml
    Type: String
  TagProject:
    Description: Tagging for the stack and its resources
    Type: String
Resources:
  ApiGatewayApi:
    Properties:
      Cors: '''*'''
      DefinitionBody:
        Fn::Transform:
          Name: AWS::Include
          Parameters:
            Location:
              Ref: SwaggerS3File
      Name: ApiGatewayApi
      StageName: Prod
    Type: AWS::Serverless::Api
  FnCourse:
    Properties:
      CodeUri: s3://angularmax.aldunate.pro-artifacts/96edb677827b6b81d04fb02f903cb0b2
      Events:
        ProxyApiRoot:
          Properties:
            Method: get
            Path: /course
            RestApiId:
              Ref: ApiGatewayApi
          Type: Api
      Handler: course-fn.getById
      Runtime: nodejs6.10
    Type: AWS::Serverless::Function
  TableCourse:
    Properties:
      PrimaryKey:
        Name: id
        Type: String
      ProvisionedThroughput:
        ReadCapacityUnits: 1
        WriteCapacityUnits: 1
      TableName: lg-course
      Tags:
        Project:
          Ref: TagProject
    Type: AWS::Serverless::SimpleTable
Transform: AWS::Serverless-2016-10-31
